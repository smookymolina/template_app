{% extends "base.html" %}

{% block title %}Seguimiento de Proceso | Sistema de Gestión de Reclutas{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        padding: 60px 0;
        text-align: center;
        margin-bottom: 30px;
    }
    
    .hero-section h1 {
        font-size: 2.5rem;
        margin-bottom: 15px;
    }
    
    .hero-section p {
        font-size: 1.2rem;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .tracking-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
    }
    
    .dark-mode .tracking-container {
        background-color: var(--light-color);
    }
    
    .tracking-form {
        margin-bottom: 30px;
    }
    
    .tracking-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .tracking-header h2 {
        color: var(--primary-color);
        margin-bottom: 10px;
    }
    
    .tracking-header p {
        color: var(--text-light);
    }
    
    /* Estilos para las instrucciones del folio */
    .folio-guide {
        background-color: rgba(0, 123, 255, 0.05);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 30px;
        border-left: 4px solid var(--primary-color);
    }
    
    .dark-mode .folio-guide {
        background-color: rgba(0, 123, 255, 0.03);
    }
    
    .folio-guide h3 {
        font-size: 18px;
        color: var(--primary-color);
        margin-top: 0;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }
    
    .folio-guide h3 i {
        margin-right: 10px;
    }
    
    .folio-guide h4 {
        font-size: 16px;
        margin: 20px 0 10px;
        color: var(--text-color);
        display: flex;
        align-items: center;
    }
    
    .folio-guide h4 i {
        margin-right: 8px;
        color: var(--primary-color);
    }
    
    .folio-guide p {
        margin-bottom: 10px;
    }
    
    .folio-guide ul {
        padding-left: 20px;
        margin-bottom: 15px;
    }
    
    .folio-guide li {
        margin-bottom: 8px;
        position: relative;
        padding-left: 5px;
    }
    
    .folio-guide .folio-example {
        font-family: monospace;
        background-color: rgba(0, 0, 0, 0.05);
        padding: 2px 6px;
        border-radius: 4px;
    }
    
    .folio-guide .contact-info {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px dashed var(--border-color);
    }
    
    .help-text {
        margin-top: 20px;
        padding: 15px;
        background-color: rgba(0, 123, 255, 0.1);
        border-left: 4px solid var(--primary-color);
        border-radius: 4px;
    }
    
    .tracking-contact {
        margin-top: 40px;
        text-align: center;
    }
    
    .dark-mode .help-text {
        background-color: rgba(0, 123, 255, 0.05);
    }
    
    /* Botón del formulario centrado */
    .form-button {
        text-align: center;
        margin-top: 20px;
    }
    
    .form-button .btn-primary {
        min-width: 180px;
    }
    
    /* Estilos para la mini FAQ */
    .faq-section {
        margin-top: 40px;
    }
    
    .faq-item {
        margin-bottom: 20px;
    }
    
    .faq-question {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 8px;
    }
    
    .faq-answer {
        color: var(--text-color);
    }
    
    /* Estado inactivo de la navegación */
    .header-nav {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 20px;
    }
    
    .header-nav a {
        color: white;
        opacity: 0.8;
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
    }
    
    .header-nav a:hover, .header-nav a.active {
        opacity: 1;
    }
    
    /* Footer simple */
    .simple-footer {
        margin-top: 60px;
        text-align: center;
        padding: 20px;
        color: var(--text-light);
        border-top: 1px solid var(--border-color);
    }
    
    /* Estilos para resultados y timeline */
    .tracking-result-card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        padding: 20px;
        margin-bottom: 20px;
        transition: var(--transition);
    }
    
    .dark-mode .tracking-result-card {
        background-color: var(--light-color);
    }
    
    .tracking-result-card h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: var(--primary-color);
        font-weight: 600;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .tracking-row {
        display: flex;
        margin-bottom: 12px;
    }
    
    .tracking-label {
        width: 140px;
        font-weight: 600;
        color: var(--text-color);
    }
    
    .tracking-value {
        flex: 1;
    }
    
    .tracking-section {
        margin-top: 20px;
        padding-top: 10px;
        border-top: 1px solid var(--border-color);
    }
    
    /* Estilos para timeline */
    .timeline-container {
        padding: 20px 0;
        margin-bottom: 30px;
    }
    
    .timeline {
        position: relative;
        padding: 20px 0;
        margin-bottom: 30px;
    }
    
    /* Línea central */
    .timeline::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50px;
        height: 100%;
        width: 4px;
        background: var(--border-color);
        z-index: 1;
    }
    
    .dark-mode .timeline::before {
        background: #3f3f3f;
    }
    
    /* Elementos de la timeline */
    .timeline-item {
        position: relative;
        margin-bottom: 30px;
        padding-left: 100px;
    }
    
    .timeline-item:last-child {
        margin-bottom: 0;
    }
    
    /* Marcador circular */
    .timeline-marker {
        position: absolute;
        left: 42px;
        top: 0;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--light-color);
        border: 4px solid var(--border-color);
        z-index: 2;
        transform: translateX(-50%);
        transition: var(--transition);
    }
    
    .dark-mode .timeline-marker {
        background: var(--primary-light);
        border-color: #3f3f3f;
    }
    
    /* Estado completado */
    .timeline-item.completed .timeline-marker {
        background: var(--success-color);
        border-color: var(--success-color);
    }
    
    /* Estado activo (en progreso) */
    .timeline-item.active .timeline-marker {
        background: var(--primary-color);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.2);
    }
    
    /* Contenido de cada elemento */
    .timeline-content {
        padding: 15px;
        border-radius: var(--border-radius);
        background: white;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
    }
    
    .dark-mode .timeline-content {
        background: var(--light-color);
    }
    
    .timeline-item.completed .timeline-content {
        border-left: 4px solid var(--success-color);
    }
    
    .timeline-item.active .timeline-content {
        border-left: 4px solid var(--primary-color);
        box-shadow: var(--shadow-md);
    }
    
    .timeline-content h4 {
        margin: 0 0 8px;
        color: var(--text-color);
        font-weight: 600;
        transition: var(--transition);
    }
    
    .timeline-content p {
        margin: 0;
        color: var(--text-light);
        font-size: 14px;
    }
    
    .timeline-item.active .timeline-content h4 {
        color: var(--primary-color);
    }
    
    .timeline-item.completed .timeline-content h4 {
        color: var(--success-color);
    }
    
    /* Adaptación responsive */
    @media (max-width: 576px) {
        .tracking-row {
            flex-direction: column;
        }
        
        .tracking-label {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .timeline::before {
            left: 30px;
        }
        
        .timeline-item {
            padding-left: 70px;
        }
        
        .timeline-marker {
            left: 22px;
            width: 16px;
            height: 16px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container">
        <h1>Seguimiento de Proceso</h1>
        <p>Consulta el estado de tu proceso de reclutamiento de manera fácil y rápida</p>
        
        <div class="header-nav">
            <a href="{{ url_for('main.index') }}">Inicio</a>
            <a href="{{ url_for('main.seguimiento') }}" class="active">Seguimiento</a>
            <a href="#contacto">Contacto</a>
        </div>
    </div>
</div>

<div class="container">
    <div class="tracking-container">
        <div class="tracking-header">
            <h2>Consulta tu Estado</h2>
            <p>Ingresa tu número de folio para conocer el estado actual de tu proceso</p>
        </div>
        
        <!-- Guía sobre el folio de seguimiento -->
        <div class="folio-guide">
            <h3><i class="fas fa-info-circle"></i> Guía del Folio de Seguimiento</h3>
            
            <p>El folio de seguimiento es un código único que te permite consultar el estado de tu postulación en nuestro sistema de reclutamiento. A continuación te explicamos cómo obtenerlo y utilizarlo:</p>
            
            <h4><i class="fas fa-id-card"></i> ¿Cómo obtener tu folio?</h4>
            <ul>
                <li>El folio se genera automáticamente cuando tu currículum es registrado en nuestro sistema.</li>
                <li>Recibirás un correo electrónico de confirmación con el folio al iniciar tu proceso.</li>
                <li>También puedes obtenerlo directamente de tu asesor de reclutamiento asignado.</li>
                <li>Si completaste un formulario de solicitud de empleo en nuestro sitio web, el folio se muestra en la pantalla de confirmación y se envía a tu correo electrónico.</li>
            </ul>
            
            <h4><i class="fas fa-keyboard"></i> Formato del folio</h4>
            <p>El folio siempre tiene el siguiente formato: <span class="folio-example">REC-XXXXXXXX</span> donde las X son una combinación de letras (A-F) y números (0-9).</p>
            <p>Ejemplos: <span class="folio-example">REC-1A2B3C4D</span>, <span class="folio-example">REC-5E6F7890</span></p>
            
            <h4><i class="fas fa-search"></i> ¿No encuentras tu folio?</h4>
            <ul>
                <li>Revisa la carpeta de spam o correo no deseado de tu email.</li>
                <li>Si aplicaste recientemente, espera al menos 24 horas para recibir tu folio.</li>
                <li>Contacta a tu asesor asignado o al departamento de recursos humanos.</li>
            </ul>
            
            <div class="contact-info">
                <p><strong>¿Necesitas ayuda?</strong> Comunícate con nosotros:</p>
                <p>📧 Email: <a href="mailto:contacto@empresa.com">contacto@empresa.com</a><br>
                📞 Teléfono: (55) 1234-5678<br>
                ⏰ Horario de atención: Lunes a Viernes de 9:00 a 18:00</p>
            </div>
        </div>
        
        <div id="tracking-form" class="tracking-form">
            <div class="form-group">
                <label for="folio">Folio de Seguimiento</label>
                <div class="input-icon-wrapper">
                    <i class="fas fa-file-alt"></i>
                    <input type="text" id="folio" placeholder="Ingresa tu folio (Ejemplo: REC-1A2B3C4D)" required>
                </div>
            </div>
            
            <div class="form-button">
                <button id="consultar-btn" class="btn-primary">
                    <i class="fas fa-search"></i> Consultar Estado
                </button>
            </div>
            
            <div class="help-text">
                <i class="fas fa-info-circle"></i> 
                El número de folio se te proporcionó al iniciar tu proceso. Si no cuentas con él, 
                comunícate con tu asesor o al correo <a href="mailto:contacto@empresa.com">contacto@empresa.com</a>.
            </div>
        </div>
        
        <!-- Contenedor para mostrar los resultados (inicialmente oculto) -->
        <div id="tracking-results" style="display: none;">
            <!-- Los resultados se cargarán dinámicamente aquí -->
        </div>
        
        <div class="faq-section">
            <h3>Preguntas Frecuentes</h3>
            
            <div class="faq-item">
                <div class="faq-question">¿Qué información necesito para obtener mi folio?</div>
                <div class="faq-answer">
                    Tu folio se genera automáticamente cuando registramos tu aplicación. Para obtenerlo necesitarás:
                    <ul>
                        <li>Haber completado tu postulación o entregado tu currículum</li>
                        <li>Proporcionar un correo electrónico válido donde recibirás el folio</li>
                        <li>En algunos casos, completar un formulario inicial de solicitud</li>
                    </ul>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">¿Con qué frecuencia se actualiza la información?</div>
                <div class="faq-answer">
                    La información se actualiza en tiempo real. Cada vez que hay un avance en tu proceso, 
                    podrás consultarlo inmediatamente en esta plataforma.
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">¿Qué hago si olvidé mi número de folio?</div>
                <div class="faq-answer">
                    Si olvidaste tu número de folio, tienes varias opciones:
                    <ul>
                        <li>Revisa el correo que recibiste al iniciar tu proceso</li>
                        <li>Comunícate con tu asesor asignado</li>
                        <li>Envía un correo a <a href="mailto:contacto@empresa.com">contacto@empresa.com</a> proporcionando tu nombre completo y correo electrónico con el que te registraste</li>
                        <li>Llama al (55) 1234-5678 en horario de oficina</li>
                    </ul>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">¿El folio tiene fecha de expiración?</div>
                <div class="faq-answer">
                    No, tu folio de seguimiento permanece activo durante todo el proceso de reclutamiento y hasta 6 meses después de finalizado, lo que te permite consultar tu estatus en cualquier momento durante este período.
                </div>
            </div>
        </div>
    </div>
    
    <div id="contacto" class="tracking-contact">
        <h3>¿Necesitas ayuda?</h3>
        <p>Estamos para apoyarte en tu proceso de reclutamiento.</p>
        <p>Correo: <a href="mailto:contacto@empresa.com">contacto@empresa.com</a> | Teléfono: (55) 1234-5678</p>
    </div>
    
    <div class="simple-footer">
        <p>&copy; 2025 Sistema de Gestión de Reclutas. Todos los derechos reservados.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Obtener elementos del DOM
        const folioInput = document.getElementById('folio');
        const consultarBtn = document.getElementById('consultar-btn');
        const trackingForm = document.getElementById('tracking-form');
        const trackingResults = document.getElementById('tracking-results');
        
        // Verificar si hay un folio en la URL (en caso de ser compartida)
        const urlParams = new URLSearchParams(window.location.search);
        const folioParam = urlParams.get('folio');
        if (folioParam) {
            folioInput.value = folioParam;
            // Si también está presente el parámetro auto_consulta, realizar la consulta automáticamente
            if (urlParams.get('auto_consulta') === 'true') {
                setTimeout(() => consultarFolio(), 500); // Pequeño retraso para mejor UX
            }
        }
        
        // Función para compartir el resultado
        function shareResultado(folio) {
            // Crear URL con el folio y el parámetro de auto consulta
            const shareUrl = `${window.location.origin}${window.location.pathname}?folio=${folio}&auto_consulta=true`;
            
            // Verificar si la API de compartir está disponible
            if (navigator.share) {
                navigator.share({
                    title: 'Seguimiento de proceso de reclutamiento',
                    text: 'Consulta el estado de mi proceso de reclutamiento',
                    url: shareUrl
                })
                .catch(error => {
                    console.error('Error al compartir:', error);
                    // Fallback: copiar al portapapeles
                    copyToClipboard(shareUrl);
                });
            } else {
                // Fallback: copiar al portapapeles
                copyToClipboard(shareUrl);
            }
        }
        
        // Función auxiliar para copiar al portapapeles
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showNotification('Enlace copiado al portapapeles. ¡Compártelo!', 'success');
        }
        
        // Función para mostrar notificaciones
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            
            if (!notification || !notificationMessage) return;
            
            notificationMessage.textContent = message;
            
            // Configurar tipo de notificación
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('show');
            
            // Auto-ocultar después de 5 segundos
            setTimeout(function() {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Función para obtener la clase del badge según el estado
        function getBadgeClass(estado) {
            switch(estado) {
                case 'Activo': return 'badge-success';
                case 'En proceso': return 'badge-warning';
                case 'Rechazado': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }
        
        // Función para obtener el texto del tipo de entrevista
        function getEntrevistaType(tipo) {
            switch(tipo) {
                case 'presencial': return 'Presencial';
                case 'virtual': return 'Virtual (Videollamada)';
                case 'telefonica': return 'Telefónica';
                default: return tipo;
            }
        }
        
        // Función para validar el formato del folio
        function validateFolio(folio) {
            if (!folio) {
                return {
                    valid: false,
                    message: "Por favor, ingresa un número de folio"
                };
            }
            
            // Eliminar espacios y convertir a mayúsculas
            folio = folio.trim().toUpperCase();
            
            // Validar formato: REC-XXXXXXXX donde X son caracteres hexadecimales
            const folioPattern = /^REC-[0-9A-F]{8}$/;
            
            if (!folioPattern.test(folio)) {
                return {
                    valid: false,
                    message: "Formato de folio inválido. El formato correcto es REC-XXXXXXXX"
                };
            }
            
            return {
                valid: true,
                message: "",
                folio: folio
            };
        }
        
        // Función para renderizar los items de la timeline según el estado
        function renderTimelineItems(currentStatus) {
            // Mapear estados del sistema a estados de la timeline
            const statusMap = {
                'En proceso': 'revision',
                'Activo': 'finalizada',
                'Rechazado': 'finalizada'
            };
            
            // Estado mapeado o por defecto
            const timelineStatus = statusMap[currentStatus] || 'recibida';
            
            // Orden de los estados
            const statusOrder = ['recibida', 'revision', 'entrevista', 'evaluacion', 'finalizada'];
            const currentIndex = statusOrder.indexOf(timelineStatus);
            
            // Generar los items
            let timelineHTML = '';
            
            statusOrder.forEach((status, index) => {
                // Determinar clase según el estado actual
                let itemClass = 'timeline-item';
                if (index < currentIndex) {
                    itemClass += ' completed';
                } else if (index === currentIndex) {
                    itemClass += ' active';
                }
                
                // Contenido según el estado
                let content = '';
                switch(status) {
                    case 'recibida':
                        content = `
                            <h4>Recibida</h4>
                            <p>Documentación recibida y registrada en el sistema.</p>
                        `;
                        break;
                    case 'revision':
                        content = `
                            <h4>En revisión</h4>
                            <p>Evaluación inicial de requisitos y perfil.</p>
                        `;
                        break;
                    case 'entrevista':
                        content = `
                            <h4>Entrevista</h4>
                            <p>Programación y realización de entrevistas.</p>
                        `;
                        break;
                    case 'evaluacion':
                        content = `
                            <h4>Evaluación</h4>
                            <p>Análisis de resultados y toma de decisiones.</p>
                        `;
                        break;
                    case 'finalizada':
                        content = `
                            <h4>Finalizada</h4>
                            <p>Proceso completado con decisión final.</p>
                        `;
                        break;
                }
                
                // Generar HTML del item
                timelineHTML += `
                    <div class="${itemClass}" data-status="${status}">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            ${content}
                        </div>
                    </div>
                `;
            });
            
            return timelineHTML;
        }
        
        // Función para consultar el folio
        function consultarFolio() {
            const folioText = folioInput.value.trim();
            
            // Validar el folio
            const validation = validateFolio(folioText);
            if (!validation.valid) {
                showNotification(validation.message, 'warning');
                folioInput.classList.add('input-error');
                setTimeout(() => folioInput.classList.remove('input-error'), 3000);
                return;
            }
            
            const folio = validation.folio;
            
            // Mostrar estado de carga
            consultarBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Consultando...';
            consultarBtn.disabled = true;
            folioInput.disabled = true;
            
            // Realizar petición al servidor
            fetch(`/api/tracking/${folio}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(response.status === 404 ? 'Folio no encontrado' : 'Error en la consulta');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        displayTrackingResults(data.tracking_info);
                        showNotification('Información obtenida correctamente', 'success');
                    } else {
                        showNotification(data.message || 'No se encontró información para este folio', 'error');
                        folioInput.classList.add('input-error');
                        setTimeout(() => folioInput.classList.remove('input-error'), 3000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification(error.message || 'Error al consultar el folio. Intenta más tarde.', 'error');
                    folioInput.classList.add('input-error');
                    setTimeout(() => folioInput.classList.remove('input-error'), 3000);
                })
                .finally(() => {
                    // Restaurar botón
                    consultarBtn.innerHTML = '<i class="fas fa-search"></i> Consultar Estado';
                    consultarBtn.disabled = false;
                    folioInput.disabled = false;
                });
        }
        
        // Función para mostrar los resultados del seguimiento
        function displayTrackingResults(info) {
            if (!info) return;
            
            // Ocultar formulario
            trackingForm.style.display = 'none';
            
            // Crear contenido de resultados
            trackingResults.innerHTML = `
                <div class="tracking-result-card">
                    <h3>Información de Proceso</h3>
                    <div class="tracking-info">
                        <div class="tracking-row">
                            <div class="tracking-label">Candidato:</div>
                            <div class="tracking-value">${info.nombre}</div>
                        </div>
                        <div class="tracking-row">
                            <div class="tracking-label">Estado:</div>
                            <div class="tracking-value">
                                <span class="badge ${getBadgeClass(info.estado)}">${info.estado}</span>
                            </div>
                        </div>
                        <div class="tracking-row">
                            <div class="tracking-label">Fecha de registro:</div>
                            <div class="tracking-value">${info.fecha_registro || 'No disponible'}</div>
                        </div>
                        <div class="tracking-row">
                            <div class="tracking-label">Última actualización:</div>
                            <div class="tracking-value">${info.ultima_actualizacion || 'No disponible'}</div>
                        </div>
                        ${info.proxima_entrevista ? `
                        <div class="tracking-section">
                            <h4>Próxima Entrevista</h4>
                            <div class="tracking-row">
                                <div class="tracking-label">Fecha:</div>
                                <div class="tracking-value">${info.proxima_entrevista.fecha}</div>
                            </div>
                            <div class="tracking-row">
                                <div class="tracking-label">Hora:</div>
                                <div class="tracking-value">${info.proxima_entrevista.hora}</div>
                            </div>
                            <div class="tracking-row">
                                <div class="tracking-label">Tipo:</div>
                                <div class="tracking-value">${getEntrevistaType(info.proxima_entrevista.tipo)}</div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="timeline-container">
                    <div class="timeline">
                        ${renderTimelineItems(info.estado)}
                    </div>
                </div>
                
                <button class="btn-secondary new-query-btn">
                    <i class="fas fa-arrow-left"></i> Realizar otra consulta
                </button>
                
                <!-- Botón para compartir el resultado -->
                <button class="btn-primary share-result-btn" style="margin-left: 10px;">
                    <i class="fas fa-share-alt"></i> Compartir resultado
                </button>
            `;
            
            // Mostrar el contenedor de resultados
            trackingResults.style.display = 'block';
            
            // Evento para el botón de nueva consulta
            document.getElementById('new-query-btn').addEventListener('click', function() {
                trackingResults.style.display = 'none';
                trackingForm.style.display = 'block';
                folioInput.value = '';
                folioInput.focus();
            });
        }
        
        // Función para consultar el folio
        function consultarFolio() {
            const folio = folioInput.value.trim();
            
            if (!folio) {
                showNotification('Por favor, ingresa un número de folio', 'warning');
                return;
            }
            
            // Mostrar estado de carga
            consultarBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Consultando...';
            consultarBtn.disabled = true;
            
            // Realizar petición al servidor
            fetch(`/api/tracking/${folio}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(response.status === 404 ? 'Folio no encontrado' : 'Error en la consulta');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        displayTrackingResults(data.tracking_info);
                        showNotification('Información obtenida correctamente', 'success');
                    } else {
                        showNotification(data.message || 'No se encontró información para este folio', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification(error.message || 'Error al consultar el folio. Intenta más tarde.', 'error');
                })
                .finally(() => {
                    // Restaurar botón
                    consultarBtn.innerHTML = '<i class="fas fa-search"></i> Consultar Estado';
                    consultarBtn.disabled = false;
                });
        }
        
        // Evento para el botón de consulta
        consultarBtn.addEventListener('click', consultarFolio);
        
        // Evento para la tecla Enter en el input
        folioInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                consultarFolio();
            }
        });
    });
</script>
{% endblock %}